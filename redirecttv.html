<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Project/PHP/PHPProject.php to edit this template
-->
<html>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    </head>
    <body>    
    </body>    
    <script>
        var flussonicServers = ["https://cdn-1.livestreamgratis.com/", "https://cdn-1.livestreamgratis.com/"];
        var key = '20102023';
        var lifetime = 360 * 1;
        var desync = 300;
        var stream = new URLSearchParams(window.location.search).get('stream');
        var LinkFull = 'não deu tempo';

        function getIP(json) {
            var ipaddr = json.ip;
            var starttime = Math.floor(Date.now() / 1000) - desync;
            var endtime = starttime + lifetime;
            var salt = CryptoJS.lib.WordArray.random(16).toString();

            var hashsrt = stream + ipaddr + starttime + endtime + key + salt;
            var hash = CryptoJS.SHA1(hashsrt).toString();

            var token = hash + '-' + salt + '-' + endtime + '-' + starttime;
            var flussonic = flussonicServers[Math.floor(Math.random() * flussonicServers.length)];
            var link = flussonic + stream + '/index.m3u8?token=' + token + '&remote=' + ipaddr;
            LinkFull = link;
            //setupPlayer(link);
            
            
            testRedirect();

            //window.location.href = link;

            const headers = new Headers();
            headers.append('Valdec', '***teste aqui sua xereca brilhante**');       
            

        
        }
        
        async function testRedirect() {
            const response = await fetch('rocha33.github.io/util/redirecttv.html?stream=' +stream, { method: 'HEAD' });
            const locationHeader = response.headers.get('location');

            if (locationHeader) {
                console.log('URL redirecionado:', locationHeader);
                // Faça algo com a URL redirecionada, como redirecionar a página ou abrir em uma nova aba
                window.location.href = locationHeader;
            } else {
                console.log('URL não foi redirecionado');
            }
        }


        var script = document.createElement('script');
        script.src = 'https://api.ipify.org?format=jsonp&callback=getIP';
        document.getElementsByTagName('head')[0].appendChild(script);

        function GetLink() {
            Toaster.GetLink(LinkFull);
        }


    </script>
</html>
